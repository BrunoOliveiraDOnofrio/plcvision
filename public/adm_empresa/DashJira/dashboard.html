<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlcVision Dashboard Jira</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Fonte google  -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../css/fonts.css">
    <link rel="stylesheet" href="../../css/nav_side_bar.css">
    <link rel="stylesheet" href="../../css/dashboards/jira.css">
    <!-- Link dos icones - boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="shortcut icon" href="../../assets/imgs/logo-aba_white.png">
</head>
<body>
    <!-- Nav Bar -->
    <header class="header-nav">
        <div class="menu-foto">
            <i id="hamb_menu" onclick="abrirSideBar()" class='bx bx-menu'></i>
            <div class="foto"></div>
            <div class="barra-sep"></div>
        </div>

        <div class="user-options">
            <span id="username">Usuário</span>
            <i onclick="menuCollapse()" class='bx bx-chevron-down'></i>
            <div id="div_menu" class="collapse-menu">
                <nav>
                    <ul>
                        <li>
                            <a href="">
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Alertas</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Perfil</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Sair</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <header class="header-nav header-nav-desk">
        <div class="menu-foto">
            <i id="hamb_menu" onclick="abrirSideBar()" class='bx bx-menu'></i>
            <div class="fotoEmpresa"></div>
            <span id="span_empresa" class="nome-empresa">Motorola</span>
            <div class="barra-sep"></div>
            <span id="span_endereco_empresa" class="endereco">Alameda Ferraz 456</span>
        </div>

        <div class="user-options">
            <div class="foto"></div>
            <span id="username">Usuário</span>
            <i onclick="menuCollapseDesk()" class='bx bx-chevron-down'></i>
            <div id="div_menu_desk" class="collapse-menu">
                <nav>
                    <ul>
                        <li>
                            <a href="">
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Alertas</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Perfil</span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span>Sair</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Side bar  -->

    <nav id="nav_sidebar" class="sidebar sidebar-fechada">
        <div class="inicio">
            <ul>
                <li>
                    <a href="./consumidores">
                        <i class='bx bx-group'></i>
                    </a>
                </li>
                <li>
                    <a href="./alertas">
                        <i class='bx bxs-bell-ring' ></i>
                    </a>
                </li>
                <li>
                    <a href="./fabricas">
                        <i class='bx bxs-factory'></i>
                    </a>
                </li>
                <li>
                    <a href="./setores">
                <i class='bx bx-category-alt'></i>
                        
                    </a>
                </li>
                <li>
                    <a href="./usuarios">
                        <i class='bx bxs-user'></i>
                    </a>
                </li>
                <li>
                    <a href="./plcs">
                        <i class='bx bx-desktop'></i>
                    </a>
                </li>
            </ul>
        </div>
        <div class="saida">
            <ul>
                <li>
                    <a href="#">
                        <i class='bx bx-exit'></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="main">
        <div class="container">
            <h1>Dashboard Alertas</h1>
    </div>

    <div class="painel">
        <div class="kpis">
            <div class="kpi">
                <h3>Alertas em Aberto</h3>
                <div id="jira-aberto">Carregando...</div>
            </div>

            <div class="kpi" id="validade">
                <h3>Alertas fora do Prazo</h3>
                <div id="jira-aberto-validade">Carregando...</div>
            </div>

            <div class="kpi">
                <h3>Alertas fechados hoje</h3>
                <div id="jira-fechado">Carregando...</div>
            </div>

            <div class="kpi">
                <h3>Componente mais Crítico</h3>
                <div id="jira-componente">Carregando...</div>
            </div>

            <div class="kpi">
                <h3>Resolução médio</h3>
                <div id="jira-tempo">Carregando...</div>
            </div>
        </div>

        <div class="dash">
            <div>
                <h2>Alerta por Componente</h2>
                <canvas id="alertaComponente"></canvas>
            </div>
            <div>
                <h2>Alertas criados na Semana</h2>
                <canvas id="alertaTraceroute"></canvas>
            </div>
            
        </div>
    </div>

</body>

<!-- <script src="../../js/nav_sidebar.js"></script> -->

</html>

<script>

    function carregarKPI1(){
        const kpi1 = document.getElementById("jira-aberto");
        fetch("/alerta/kpi1")
            .then((response) => {
                return response.json();
            })
            .then((dados) => {
                console.log("Resposta da KPI1:", dados);
                kpi1.innerHTML = dados.total;
            })
            .catch((error) => {
                console.error("Erro:", error);
                kpi1.innerHTML = "faz o L";
            });
    }

    function carregarKPI2(){
        const kpi2 = document.getElementById("jira-aberto-validade");
        const shadow = document.getElementById("validade");
        fetch("/alerta/kpi2")
            .then((response) => {
                return response.json();
            })
            .then((dados) => {
                console.log("Resposta da KPI2:", dados);
                kpi2.innerHTML = dados.total;
                if(dados.total > 0){
                    shadow.style.boxShadow = "1px 6px 12px 9px rgba(223, 32, 20, 0.61)";
                }
            })
            .catch((error) => {
                console.error("Erro:", error);
                kpi2.innerHTML = "Faz o L";
            })
    }

    function carregarKPI3(){
        const kpi3 = document.getElementById("jira-fechado");
        fetch("/alerta/kpi3")
            .then((response) => {
                return response.json();
            })
            .then((dados) => {
                console.log("Resposta da KPI3", dados);
                kpi3.innerHTML = dados.total;
            })
            .catch((error) => {
                console.error("Erro:", error);
                kpi3.innerHTML = "faz o L";
            });
    }

    function carregarKPI4(){
        const kpi4 = document.getElementById("jira-componente");
        fetch("/alerta/kpi4")
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                console.log("Resposta da KPI4:", data[0]);
                kpi4.innerHTML = data[0].tipo;
            })
            .catch((error) => {
                console.log("Erro ao carregar funcao: ", error);
                kpi4.innerHTML = "deu ruim";
            });
    }

    function carregarKPI5(){
        const kpi5 = document.getElementById("jira-tempo");
        fetch("/alerta/kpi5")
            .then((response) => {
                if(!response.ok){
                    throw new Error("Erro ao buscar a KPI4");
                }
                return response.json();
            })
            .then((data) => {
                console.log("Resposta da KPI5:", data);
                kpi5.innerHTML = data.mediaHoras + " Horas";
            })
            .catch((error) => {
                console.log("Erro ao carregar funcao: ", error);
                kpi5.innerHTML = "deu ruim";
            });
    }

    carregarKPI1();
    carregarKPI2();
    carregarKPI3();
    carregarKPI4();
    carregarKPI5();

    function gerarGraficoAlertaComponente() {
            fetch('/alerta/kpi4')
                .then(response => response.json())
                .then(dados => {
                    console.log(dados)
                    const hardware = dados.map(item => item.tipo);
                    const qtd = dados.map(item => item.total);

                    const ctx = document.getElementById('alertaComponente');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: hardware,
                            datasets: [{
                                label: 'Alertas Gerados',
                                data: qtd,
                                backgroundColor: 'white',
                                borderColor: 'black',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Hardware'
                                    },
                                    ticks: {
                                        color: '#ffffff' // Cor dos labels do eixo X
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Alertas Gerados'
                                    },
                                    ticks: {
                                        color: '#ffffff' // Cor dos labels do eixo X
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Erro ao buscar dados de motivação:', error);
                });
        }

    gerarGraficoAlertaComponente();


    function pegarTempoAlertas () {
            fetch('/alerta/graficoTraceroute')
                .then(response => response.json())
                .then(dados => {
                    console.log(dados)

                    const criados = dados.criados;
                    const resolvidos = dados.resolvidos;
                    const dias = dados.dias;

                    const ctx_2 = document.getElementById('alertaTraceroute');
                    new Chart(ctx_2, {
                    type: 'line',
                    data: {
                        labels: dias,
                        datasets: [
                            {
                                label: 'Alertas Criados ',
                                data: criados,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderWidth: 2
                            },
                            {
                                label: 'Alertas Resolvidos',
                                data: resolvidos,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        scales: {
                            x: {
                                ticks: {
                                    color: '#ffffff'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#ffffff'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#ffffff'
                                }
                            }
                        }
                    }
                });

                })
    }
    
    pegarTempoAlertas();
        

</script>